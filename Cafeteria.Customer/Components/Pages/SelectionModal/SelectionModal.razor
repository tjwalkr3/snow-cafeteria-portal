@using Cafeteria.Shared.DTOs

<GenericModal IsOpen="@IsOpen" 
              Title="Complete Your Meal" 
              OnClose="@Close"
              ModalSize="modal-xl"
              IsScrollable="true"
              FooterClass="bg-light"
              ShowCloseButton="true">
    <ChildContent>
        <ul class="nav nav-tabs nav-fill border-bottom" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link @(activeTab == "entrees" ? "active" : "")" 
                        type="button" 
                        @onclick="@(() => SetActiveTab("entrees"))">
                    Entrees
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link @(activeTab == "sides" ? "active" : "")" 
                        type="button" 
                        @onclick="@(() => SetActiveTab("sides"))">
                    Sides
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link @(activeTab == "drinks" ? "active" : "")" 
                        type="button" 
                        @onclick="@(() => SetActiveTab("drinks"))">
                    Drinks
                </button>
            </li>
        </ul>
        <div class="p-3">
            @if (activeTab == "entrees")
            {
                <div class="alert alert-warning" role="alert">
                    Select 1 entr√©e with your meal swipe
                </div>
                
                @foreach (EntreeDto item in entrees)
                {
                    <div class="card mb-2 @(selectedItems.Contains(item.Id) ? "border-primary" : "")" 
                            style="cursor: pointer;" 
                            @onclick="() => ToggleItem(item.Id)">
                        <div class="card-body d-flex justify-content-between align-items-center">
                            <div>
                                <strong>@item.EntreeName</strong>
                                @if (!string.IsNullOrEmpty(item.EntreeDescription))
                                {
                                    <small class="text-muted d-block">@item.EntreeDescription</small>
                                }
                            </div>
                            <div>
                                <span class="text-primary">$@item.EntreePrice.ToString()</span>
                            </div>
                        </div>
                    </div>
                }
            }
            else if (activeTab == "sides")
            {
                <div class="alert alert-warning" role="alert">
                    Select sides with your meal swipe
                </div>
                
                @foreach (var item in sides)
                {
                    <div class="card mb-2 @(selectedItems.Contains(item.Id) ? "border-primary" : "")" 
                            style="cursor: pointer;" 
                            @onclick="() => ToggleItem(item.Id)">
                        <div class="card-body d-flex justify-content-between align-items-center">
                            <div>
                                <strong>@item.SideName</strong>
                                @if (!string.IsNullOrEmpty(item.SideDescription))
                                {
                                    <small class="text-muted d-block">@item.SideDescription</small>
                                }
                            </div>
                            <div>
                                <span class="text-primary">@item.SidePrice.ToString("C")</span>
                            </div>
                        </div>
                    </div>
                }
            }
            else if (activeTab == "drinks")
            {
                <div class="alert alert-warning" role="alert">
                    Select drinks with your meal swipe
                </div>
                
                @foreach (var item in drinks)
                {
                    <div class="card mb-2 @(selectedItems.Contains(item.Id) ? "border-primary" : "")" 
                            style="cursor: pointer;" 
                            @onclick="() => ToggleItem(item.Id)">
                        <div class="card-body d-flex justify-content-between align-items-center">
                            <div>
                                <strong>@item.DrinkName</strong>
                                @if (!string.IsNullOrEmpty(item.DrinkDescription))
                                {
                                    <small class="text-muted d-block">@item.DrinkDescription</small>
                                }
                            </div>
                            <div>
                                <span class="text-primary">@item.DrinkPrice.ToString("C")</span>
                            </div>
                        </div>
                    </div>
                }
            }
        </div>
    </ChildContent>
    <FooterContent>
        <div class="d-flex justify-content-between align-items-center w-100">
            <span>@selectedItems.Count items selected</span>
            <button type="button" 
                    class="btn btn-secondary btn-lg" 
                    disabled="@(selectedItems.Count == 0)"
                    @onclick="AddToOrder">
                Add to Order
            </button>
        </div>
    </FooterContent>
</GenericModal>

@code {
    [Parameter]
    public bool IsOpen { get; set; }

    [Parameter]
    public EventCallback OnClose { get; set; }

    private string activeTab = "entrees";
    private HashSet<int> selectedItems = new HashSet<int>();

    private List<EntreeDto> entrees = new List<EntreeDto>
    {
        new EntreeDto { Id = 1, EntreeName = "Cheeseburger", EntreeDescription = "Classic beef burger with cheese", EntreePrice = 4.99m, StationId = 1 },
        new EntreeDto { Id = 2, EntreeName = "Grilled Chicken Sandwich", EntreeDescription = "Grilled chicken breast on a bun", EntreePrice = 5.19m, StationId = 1 },
        new EntreeDto { Id = 3, EntreeName = "BLT Sandwich", EntreeDescription = "Bacon, lettuce, and tomato", EntreePrice = 4.89m, StationId = 1 },
        new EntreeDto { Id = 4, EntreeName = "Personal Pizza", EntreeDescription = "Individual sized pizza", EntreePrice = 5.69m, StationId = 1 }
    };

    private List<SideDto> sides = new List<SideDto>
    {
        new SideDto { Id = 5, SideName = "French Fries", SideDescription = "Crispy golden fries", SidePrice = 2.49m, StationId = 1 },
        new SideDto { Id = 6, SideName = "Onion Rings", SideDescription = "Breaded and fried onion rings", SidePrice = 2.99m, StationId = 1 },
        new SideDto { Id = 7, SideName = "Side Salad", SideDescription = "Fresh garden salad", SidePrice = 2.79m, StationId = 1 },
        new SideDto { Id = 8, SideName = "Fruit Cup", SideDescription = "Mixed fresh fruit", SidePrice = 2.29m, StationId = 1 }
    };

    private List<DrinkDto> drinks = new List<DrinkDto>
    {
        new DrinkDto { Id = 9, DrinkName = "Fountain Drink", DrinkDescription = "Choice of soft drink", DrinkPrice = 1.99m, StationId = 1 },
        new DrinkDto { Id = 10, DrinkName = "Bottled Water", DrinkDescription = "Purified bottled water", DrinkPrice = 1.49m, StationId = 1 },
        new DrinkDto { Id = 11, DrinkName = "Juice", DrinkDescription = "Orange or apple juice", DrinkPrice = 2.29m, StationId = 1 },
        new DrinkDto { Id = 12, DrinkName = "Milk", DrinkDescription = "2% or whole milk", DrinkPrice = 1.79m, StationId = 1 }
    };

    private void SetActiveTab(string tab)
    {
        activeTab = tab;
    }

    private void ToggleItem(int itemId)
    {
        if (selectedItems.Contains(itemId))
        {
            selectedItems.Remove(itemId);
        }
        else
        {
            selectedItems.Add(itemId);
        }
    }

    private async Task Close()
    {
        IsOpen = false;
        selectedItems.Clear();
        activeTab = "entrees";
        await OnClose.InvokeAsync();
    }

    private async Task AddToOrder()
    {
        await Close();
    }
}
