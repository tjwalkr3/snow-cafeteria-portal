@page "/breakfast"
@rendermode InteractiveServer
@using Cafeteria.Shared.DTOs

<PageTitle>Breakfast Station</PageTitle>

<div class="my-4">
    <div class="mb-4">
        <h1 class="fw-light text-dark mb-1">
            <i class="bi bi-egg-fried me-2 text-warning"></i>Complete Your Meal
        </h1>
        <p class="text-muted small mb-0">Breakfast Station</p>
    </div>

    <div class="card border-0 shadow-sm">
        <ul class="nav nav-tabs border-0 bg-light" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link border-0 @(activeTab == "entrees" ? "active bg-white" : "text-muted")"
                        type="button"
                        @onclick="@(() => SetActiveTab("entrees"))">
                    Entrees
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link border-0 @(activeTab == "sides" ? "active bg-white" : "text-muted")"
                        type="button"
                        @onclick="@(() => SetActiveTab("sides"))">
                    Sides
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link border-0 @(activeTab == "drinks" ? "active bg-white" : "text-muted")"
                        type="button"
                        @onclick="@(() => SetActiveTab("drinks"))">
                    Drinks
                </button>
            </li>
        </ul>

        <div class="card-body p-4">
            @if (activeTab == "entrees")
            {
                <div class="alert alert-light border-warning border-start border-4 mb-4" role="alert">
                    <small class="text-dark">
                        Choose ONE breakfast option for a swipe. Each option will come with a fountain drink.
                        <span class="text-danger fw-semibold">NO SUBSTITUTIONS!</span>
                    </small>
                </div>

                @foreach (var entree in Entrees)
                {
                    <div class="border rounded mb-3 @(selectedEntree?.Id == entree.Id ? "border-dark border-2 bg-light" : "border-light")"
                         style="cursor: pointer; transition: all 0.2s;"
                         @onclick="() => SelectEntree(entree)">
                        <div class="p-3">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1">
                                    <h6 class="mb-1 fw-semibold">@entree.EntreeName</h6>
                                    @if (!string.IsNullOrEmpty(entree.EntreeDescription))
                                    {
                                        <p class="text-muted small mb-0">@entree.EntreeDescription</p>
                                    }
                                </div>
                                <div class="text-end ms-3">
                                    <span class="text-dark fw-semibold">$@entree.EntreePrice.ToString("F2")</span>
                                </div>
                            </div>

                            @if (selectedEntree?.Id == entree.Id)
                            {
                                <div class="mt-3 pt-3 border-top border-light">
                                    @if (entree.Id == 1)
                                    {
                                        <div class="mb-3">
                                            <label class="form-label small fw-semibold text-muted mb-2">BREAD CHOICE</label>
                                            <div class="btn-group w-100" role="group">
                                                <input type="radio" class="btn-check" name="bread" id="bread-muffin"
                                                       checked="@(selectedBreadOption == "English Muffin")"
                                                       @onchange="@(() => selectedBreadOption = "English Muffin")">
                                                <label class="btn btn-sm btn-outline-dark" for="bread-muffin">English Muffin</label>

                                                <input type="radio" class="btn-check" name="bread" id="bread-biscuit"
                                                       checked="@(selectedBreadOption == "Biscuit")"
                                                       @onchange="@(() => selectedBreadOption = "Biscuit")">
                                                <label class="btn btn-sm btn-outline-dark" for="bread-biscuit">Biscuit</label>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="form-label small fw-semibold text-muted mb-2">MEAT CHOICE</label>
                                            <div class="btn-group w-100" role="group">
                                                <input type="radio" class="btn-check" name="meat1" id="meat1-sausage"
                                                       checked="@(selectedMeatOption == "Sausage")"
                                                       @onchange="@(() => selectedMeatOption = "Sausage")">
                                                <label class="btn btn-sm btn-outline-dark" for="meat1-sausage">Sausage</label>

                                                <input type="radio" class="btn-check" name="meat1" id="meat1-bacon"
                                                       checked="@(selectedMeatOption == "Bacon")"
                                                       @onchange="@(() => selectedMeatOption = "Bacon")">
                                                <label class="btn btn-sm btn-outline-dark" for="meat1-bacon">Bacon</label>

                                                <input type="radio" class="btn-check" name="meat1" id="meat1-ham"
                                                       checked="@(selectedMeatOption == "Ham")"
                                                       @onchange="@(() => selectedMeatOption = "Ham")">
                                                <label class="btn btn-sm btn-outline-dark" for="meat1-ham">Ham</label>
                                            </div>
                                        </div>
                                    }

                                    @if (entree.Id == 2)
                                    {
                                        <div>
                                            <label class="form-label small fw-semibold text-muted mb-2">MEAT CHOICE</label>
                                            <div class="btn-group w-100" role="group">
                                                <input type="radio" class="btn-check" name="meat2" id="meat2-bacon"
                                                       checked="@(selectedMeatOption == "Bacon")"
                                                       @onchange="@(() => selectedMeatOption = "Bacon")">
                                                <label class="btn btn-sm btn-outline-dark" for="meat2-bacon">Bacon</label>

                                                <input type="radio" class="btn-check" name="meat2" id="meat2-ham"
                                                       checked="@(selectedMeatOption == "Ham")"
                                                       @onchange="@(() => selectedMeatOption = "Ham")">
                                                <label class="btn btn-sm btn-outline-dark" for="meat2-ham">Ham</label>

                                                <input type="radio" class="btn-check" name="meat2" id="meat2-sausage"
                                                       checked="@(selectedMeatOption == "Sausage")"
                                                       @onchange="@(() => selectedMeatOption = "Sausage")">
                                                <label class="btn btn-sm btn-outline-dark" for="meat2-sausage">Sausage</label>
                                            </div>
                                        </div>
                                    }

                                    @if (entree.Id == 4)
                                    {
                                        <div>
                                            <label class="form-label small fw-semibold text-muted mb-2">MEAT CHOICE</label>
                                            <div class="btn-group w-100" role="group">
                                                <input type="radio" class="btn-check" name="meat4" id="meat4-sausage"
                                                       checked="@(selectedMeatOption == "Sausage")"
                                                       @onchange="@(() => selectedMeatOption = "Sausage")">
                                                <label class="btn btn-sm btn-outline-dark" for="meat4-sausage">Sausage</label>

                                                <input type="radio" class="btn-check" name="meat4" id="meat4-bacon"
                                                       checked="@(selectedMeatOption == "Bacon")"
                                                       @onchange="@(() => selectedMeatOption = "Bacon")">
                                                <label class="btn btn-sm btn-outline-dark" for="meat4-bacon">Bacon</label>

                                                <input type="radio" class="btn-check" name="meat4" id="meat4-ham"
                                                       checked="@(selectedMeatOption == "Ham")"
                                                       @onchange="@(() => selectedMeatOption = "Ham")">
                                                <label class="btn btn-sm btn-outline-dark" for="meat4-ham">Ham</label>
                                            </div>
                                        </div>
                                    }

                                    @if (entree.Id == 7)
                                    {
                                        <div>
                                            <label class="form-label small fw-semibold text-muted mb-2">MEAT CHOICE</label>
                                            <div class="btn-group w-100" role="group">
                                                <input type="radio" class="btn-check" name="meat7" id="meat7-sausage"
                                                       checked="@(selectedMeatOption == "Sausage")"
                                                       @onchange="@(() => selectedMeatOption = "Sausage")">
                                                <label class="btn btn-sm btn-outline-dark" for="meat7-sausage">Sausage</label>

                                                <input type="radio" class="btn-check" name="meat7" id="meat7-bacon"
                                                       checked="@(selectedMeatOption == "Bacon")"
                                                       @onchange="@(() => selectedMeatOption = "Bacon")">
                                                <label class="btn btn-sm btn-outline-dark" for="meat7-bacon">Bacon</label>

                                                <input type="radio" class="btn-check" name="meat7" id="meat7-ham"
                                                       checked="@(selectedMeatOption == "Ham")"
                                                       @onchange="@(() => selectedMeatOption = "Ham")">
                                                <label class="btn btn-sm btn-outline-dark" for="meat7-ham">Ham</label>
                                            </div>
                                        </div>
                                    }
                                </div>
                            }
                        </div>
                    </div>
                }
            }
            else if (activeTab == "sides")
            {
                <div class="alert alert-light border-warning border-start border-4 mb-4" role="alert">
                    <small class="text-dark">Select 1 side with your meal swipe</small>
                </div>

                @foreach (var side in Sides)
                {
                    <div class="border rounded mb-2 @(selectedSide?.Id == side.Id ? "border-dark border-2 bg-light" : "border-light")"
                         style="cursor: pointer; transition: all 0.2s;"
                         @onclick="() => SelectSide(side)">
                        <div class="p-3 d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-0 fw-semibold">@side.SideName</h6>
                                @if (!string.IsNullOrEmpty(side.SideDescription))
                                {
                                    <p class="text-muted small mb-0">@side.SideDescription</p>
                                }
                            </div>
                            <div>
                                <span class="text-dark fw-semibold">$@side.SidePrice.ToString("F2")</span>
                            </div>
                        </div>
                    </div>
                }
            }
            else if (activeTab == "drinks")
            {
                <div class="alert alert-light border-info border-start border-4 mb-4" role="alert">
                    <small class="text-dark">
                        <i class="bi bi-info-circle me-2"></i>Select 1 drink included with your meal swipe
                    </small>
                </div>

                @if (Drinks.Any())
                {
                    @foreach (var drink in Drinks)
                    {
                        <div class="border rounded mb-2 @(selectedDrink?.Id == drink.Id ? "border-dark border-2 bg-light" : "border-light")"
                             style="cursor: pointer; transition: all 0.2s;"
                             @onclick="() => SelectDrink(drink)">
                            <div class="p-3 d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-0 fw-semibold">@drink.DrinkName</h6>
                                    @if (!string.IsNullOrEmpty(drink.DrinkDescription))
                                    {
                                        <p class="text-muted small mb-0">@drink.DrinkDescription</p>
                                    }
                                </div>
                                <div>
                                    @if (selectedDrink?.Id == drink.Id)
                                    {
                                        <i class="bi bi-check-circle-fill text-dark fs-5"></i>
                                    }
                                </div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="border border-dark border-2 rounded bg-light">
                        <div class="p-3 d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-0 fw-semibold">Fountain Drink</h6>
                                <p class="text-muted small mb-0">Included with your meal</p>
                            </div>
                            <div>
                                <i class="bi bi-check-circle-fill text-dark fs-5"></i>
                            </div>
                        </div>
                    </div>
                }
            }
        </div>

        <div class="card-footer bg-white border-top">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <span class="text-muted small">@GetSelectionCount() items selected</span>
                    @if (selectedEntree != null && RequiresMeatSelection(selectedEntree.Id))
                    {
                        @if (!string.IsNullOrEmpty(selectedMeatOption))
                        {
                            <span class="badge bg-dark ms-2">@selectedMeatOption</span>
                        }
                    }
                    @if (selectedEntree?.Id == 1 && !string.IsNullOrEmpty(selectedBreadOption))
                    {
                        <span class="badge bg-secondary ms-2">@selectedBreadOption</span>
                    }
                </div>
                <button type="button"
                        class="btn btn-dark btn-lg px-4"
                        disabled="@(!IsValidSelection())"
                        @onclick="AddToOrder">
                    Add to Order
                </button>
            </div>
        </div>
    </div>

    @if (orderConfirmation != null)
    {
        <div class="alert alert-light border-success border-start border-4 mt-4" role="alert">
            <div class="d-flex align-items-start">
                <i class="bi bi-check-circle-fill text-success fs-4 me-3"></i>
                <div class="flex-grow-1">
                    <h6 class="fw-semibold mb-1">Order Added!</h6>
                    <p class="mb-0 small">@orderConfirmation</p>
                </div>
                <button type="button" class="btn-close" @onclick="() => orderConfirmation = null"></button>
            </div>
        </div>
    }
</div>

<style>
    .nav-link {
        color: #6c757d;
        font-weight: 500;
        padding: 1rem 1.5rem;
        transition: all 0.2s;
    }

    .nav-link.active {
        color: #212529;
        border-bottom: 2px solid #212529 !important;
    }

    .nav-link:hover {
        color: #212529;
    }

    .btn-outline-dark:hover {
        background-color: #212529;
        border-color: #212529;
    }

    .btn-check:checked + .btn-outline-dark {
        background-color: #212529;
        border-color: #212529;
    }
</style>

@code {
    private List<EntreeDto> Entrees = new List<EntreeDto>
    {
        new EntreeDto { Id = 1, StationId = 1, EntreeName = "Breakfast Sandwich", EntreeDescription = "Bread: English Muffin or Biscuit. ONE CHOICE of Meat: Sausage, Bacon, or Ham", EntreePrice = 4.99m },
        new EntreeDto { Id = 2, StationId = 1, EntreeName = "Breakfast Burrito", EntreeDescription = "Eggs, potatoes, cheese and choice of ONE MEAT: Bacon, Ham, or Sausage", EntreePrice = 5.29m },
        new EntreeDto { Id = 3, StationId = 1, EntreeName = "1 Pancake and Potatoes", EntreePrice = 4.49m },
        new EntreeDto { Id = 4, StationId = 1, EntreeName = "1 Pancake and Choice of ONE Meat", EntreeDescription = "Sausage, Bacon, or Ham", EntreePrice = 4.99m },
        new EntreeDto { Id = 5, StationId = 1, EntreeName = "French Toast and Potatoes", EntreePrice = 4.79m },
        new EntreeDto { Id = 6, StationId = 1, EntreeName = "1 Biscuit and Gravy with Potatoes", EntreePrice = 4.49m },
        new EntreeDto { Id = 7, StationId = 1, EntreeName = "Breakfast Plate", EntreeDescription = "Scrambled eggs, potatoes, one slice of toast and ONE choice of meat: Sausage, Bacon, or Ham", EntreePrice = 5.49m }
    };

    private List<SideDto> Sides = new List<SideDto>
    {
        new SideDto { Id = 1, StationId = 1, SideName = "Toast", SidePrice = 1.49m },
        new SideDto { Id = 2, StationId = 1, SideName = "Bacon", SidePrice = 2.29m },
        new SideDto { Id = 3, StationId = 1, SideName = "Sausage Link", SidePrice = 2.29m },
        new SideDto { Id = 4, StationId = 1, SideName = "Tater Tots", SidePrice = 2.79m },
        new SideDto { Id = 5, StationId = 1, SideName = "Potatoes", SidePrice = 1.99m }
    };

    private List<DrinkDto> Drinks = new List<DrinkDto>
    {
        new DrinkDto { Id = 1, StationId = 1, DrinkName = "Fountain Drinks", DrinkDescription = "Included with your meal", DrinkPrice = 0.00m },
        new DrinkDto { Id = 2, StationId = 1, DrinkName = "Slushies", DrinkDescription = "Included with your meal", DrinkPrice = 0.00m },
        new DrinkDto { Id = 3, StationId = 1, DrinkName = "Tea/Coffee Machines", DrinkDescription = "Included with your meal", DrinkPrice = 0.00m },
        new DrinkDto { Id = 4, StationId = 1, DrinkName = "Tea/Coffee Fridge", DrinkDescription = "Included with your meal", DrinkPrice = 0.00m },
        new DrinkDto { Id = 5, StationId = 1, DrinkName = "Drink Fridge", DrinkDescription = "Included with your meal", DrinkPrice = 0.00m }
    };

    private string activeTab = "entrees";
    private EntreeDto? selectedEntree = null;
    private SideDto? selectedSide = null;
    private DrinkDto? selectedDrink = null;
    private string? orderConfirmation = null;

    private string? selectedMeatOption = null;
    private string? selectedBreadOption = null;

    private void SetActiveTab(string tab)
    {
        activeTab = tab;
    }

    private void SelectEntree(EntreeDto entree)
    {
        selectedEntree = entree;

        selectedMeatOption = null;
        selectedBreadOption = null;

        if (RequiresBreadSelection(entree.Id))
        {
            selectedBreadOption = "English Muffin";
        }

        if (RequiresMeatSelection(entree.Id))
        {
            selectedMeatOption = "Sausage";
        }
    }

    private void SelectSide(SideDto side)
    {
        selectedSide = side;
    }

    private void SelectDrink(DrinkDto drink)
    {
        selectedDrink = drink;
    }

    private bool RequiresMeatSelection(int entreeId)
    {
        return entreeId == 1 || entreeId == 2 || entreeId == 4 || entreeId == 7;
    }

    private bool RequiresBreadSelection(int entreeId)
    {
        return entreeId == 1;
    }

    private int GetSelectionCount()
    {
        int count = 0;
        if (selectedEntree != null) count++;
        if (selectedSide != null) count++;
        if (selectedDrink != null) count++;
        return count;
    }

    private bool IsValidSelection()
    {
        if (selectedEntree == null || selectedSide == null || selectedDrink == null)
            return false;

        if (RequiresMeatSelection(selectedEntree.Id) && string.IsNullOrEmpty(selectedMeatOption))
            return false;

        if (RequiresBreadSelection(selectedEntree.Id) && string.IsNullOrEmpty(selectedBreadOption))
            return false;

        return true;
    }

    private void ClearSelections()
    {
        selectedEntree = null;
        selectedSide = null;
        selectedDrink = null;
        selectedMeatOption = null;
        selectedBreadOption = null;
        activeTab = "entrees";
    }

    private void AddToOrder()
    {
        if (IsValidSelection() && selectedEntree != null && selectedSide != null && selectedDrink != null)
        {
            var meal = new MealDto
            {
                EntreeId = selectedEntree.Id,
                SideId = selectedSide.Id,
                DrinkId = selectedDrink.Id
            };

            var customizations = new List<string>();
            if (!string.IsNullOrEmpty(selectedBreadOption))
                customizations.Add(selectedBreadOption);
            if (!string.IsNullOrEmpty(selectedMeatOption))
                customizations.Add(selectedMeatOption);

            var customizationText = customizations.Any() ? $" ({string.Join(", ", customizations)})" : "";
            orderConfirmation = $"Meal Plan/Swipe: {selectedEntree.EntreeName}{customizationText} with {selectedSide.SideName}";

            Console.WriteLine($"Breakfast Order: EntreeId={meal.EntreeId}, SideId={meal.SideId}, DrinkId={meal.DrinkId}, Meat={selectedMeatOption}, Bread={selectedBreadOption}");

            ClearSelections();
        }
    }
}
