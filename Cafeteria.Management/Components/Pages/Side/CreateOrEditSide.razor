@rendermode InteractiveServer
@using Cafeteria.Management.Components.Shared

<Toast Message="@ViewModel.ToastMessage" 
    Type="@ViewModel.ToastType" 
    IsVisible="@ViewModel.ShowToast" 
    OnClose="@(() => ViewModel.ShowToast = false)" />

<div class="modal fade show d-block" tabindex="-1" role="dialog" style="background-color: rgba(0,0,0,0.5);">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">@(ViewModel.IsEditMode ? $"Edit Side: {ViewModel.CurrentSide.SideName}" : "Create a Side")</h5>
                <button type="button" class="btn-close" @onclick="OnCancel" aria-label="Close"></button>
            </div>
            <EditForm Model="@ViewModel.CurrentSide" OnValidSubmit="HandleValidSubmit">
                <DataAnnotationsValidator />
                <div class="modal-body">
                    @if (!string.IsNullOrEmpty(ErrorMessage))
                    {
                        <div class="alert alert-danger">@ErrorMessage</div>
                    }

                    <h6>BASIC INFORMATION</h6>
                    <div class="mb-3">
                        <label class="form-label">Side Name:</label>
                        <InputText class="form-control" @bind-Value="ViewModel.CurrentSide.SideName" />
                        <ValidationMessage For="@(() => ViewModel.CurrentSide.SideName)" />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Description:</label>
                        <InputTextArea class="form-control" @bind-Value="ViewModel.CurrentSide.SideDescription" />
                        <ValidationMessage For="@(() => ViewModel.CurrentSide.SideDescription)" />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Price:</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <InputNumber class="form-control" @bind-Value="ViewModel.CurrentSide.SidePrice" />
                        </div>
                        <ValidationMessage For="@(() => ViewModel.CurrentSide.SidePrice)" />
                    </div>

                    <h6>LOCATION & STATION</h6>
                    <div class="mb-3">
                        <label class="form-label">Location:</label>
                        <select class="form-select" value="@SelectedLocationId" @onchange="OnLocationChanged">
                            <option value="0">Select a location</option>
                            @foreach (var loc in Locations)
                            {
                                <option value="@loc.Id">@loc.LocationName</option>
                            }
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Station:</label>
                        <InputSelect class="form-select" @bind-Value="ViewModel.CurrentSide.StationId">
                            <option value="0">Select a station</option>
                            @foreach (var station in Stations)
                            {
                                <option value="@station.Id">@station.StationName</option>
                            }
                        </InputSelect>
                        <ValidationMessage For="@(() => ViewModel.CurrentSide.StationId)" />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" @onclick="OnCancel">Cancel</button>
                    <button type="submit" class="btn btn-primary" disabled="@IsSaving">
                        @if (IsSaving)
                        {
                            <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                        }
                        @(ViewModel.IsEditMode ? "Save Side" : "Create Side")
                    </button>
                </div>
            </EditForm>
        </div>
    </div>
</div>
