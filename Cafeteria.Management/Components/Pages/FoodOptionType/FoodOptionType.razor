@page "/food-option-type"
@rendermode InteractiveServer
@using Cafeteria.Management.Components.Shared
@using Cafeteria.Management.Components.Pages.FoodOption
@using Cafeteria.Management.Components.Pages.FoodType

<PageTitle>Food Option & Type</PageTitle>

<div class="container py-4">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="mb-3">Food Option & Type</h1>
        </div>
    </div>

    <ul class="nav nav-tabs mb-4" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link @(ActiveTab == "options" ? "active" : "")" @onclick='() => SetActiveTab("options")'
                type="button" role="tab">
                Food Options
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link @(ActiveTab == "types" ? "active" : "")" @onclick='() => SetActiveTab("types")'
                type="button" role="tab">
                Food Types
            </button>
        </li>
    </ul>

    <div class="tab-content">
        @if (ActiveTab == "options")
        {
            <!-- Food Options Tab -->
            @if (FoodOptionVM.FoodOptions == null && !IsFoodOptionsInitialized)
            {
                <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-3">Loading food options...</p>
                </div>
            }
            else if (IsFoodOptionsInitialized && FoodOptionVM.ErrorOccurred())
            {
                <div class="alert alert-danger" role="alert">
                    <h4 class="alert-heading">Error</h4>
                    <p>Failed to load food options. Please try again later.</p>
                </div>
            }
            else if (FoodOptionVM.FoodOptions != null)
            {
                <div class="row mb-3">
                    <div class="col-12">
                        <button class="btn btn-primary" @onclick="ShowCreateFoodOptionModal">
                            <i class="bi bi-plus-circle"></i> Add New Food Option
                        </button>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        @if (FoodOptionVM.FoodOptions.Count == 0)
                        {
                            <div class="alert alert-info">
                                No food options found. Click "Add New Food Option" to create one.
                            </div>
                        }
                        else
                        {
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>In Stock</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var foodOption in FoodOptionVM.FoodOptions)
                                        {
                                            <tr>
                                                <td>@foodOption.FoodOptionName</td>
                                                <td>
                                                    @if (foodOption.InStock)
                                                    {
                                                        <span class="badge bg-success">In Stock</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="badge bg-danger">Out of Stock</span>
                                                    }
                                                </td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-primary me-2"
                                                        @onclick="() => ShowEditFoodOptionModal(foodOption)">
                                                        <i class="bi bi-pencil"></i> Edit
                                                    </button>
                                                    <button class="btn btn-sm btn-outline-danger"
                                                        @onclick="() => ShowDeleteFoodOptionConfirmation(foodOption)">
                                                        <i class="bi bi-trash"></i> Delete
                                                    </button>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        }
                    </div>
                </div>
            }
        }
        else if (ActiveTab == "types")
        {
            <!-- Food Types Tab -->
            @if (FoodTypeVM.FoodTypes == null && !IsFoodTypesInitialized)
            {
                <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-3">Loading food types...</p>
                </div>
            }
            else if (IsFoodTypesInitialized && FoodTypeVM.ErrorOccurred())
            {
                <div class="alert alert-danger" role="alert">
                    <h4 class="alert-heading">Error</h4>
                    <p>Failed to load food types. Please try again later.</p>
                </div>
            }
            else if (FoodTypeVM.FoodTypes != null)
            {
                <div class="row mb-3">
                    <div class="col-12">
                        <button class="btn btn-primary" @onclick="ShowCreateFoodTypeModal">
                            <i class="bi bi-plus-circle"></i> Add New Food Type
                        </button>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        @if (FoodTypeVM.FoodTypes.Count == 0)
                        {
                            <div class="alert alert-info">
                                No food types found. Click "Add New Food Type" to create one.
                            </div>
                        }
                        else
                        {
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>Type Name</th>
                                            <th>Num Included</th>
                                            <th>Max Amount</th>
                                            <th>Price</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var foodType in FoodTypeVM.FoodTypes)
                                        {
                                            <tr>
                                                <td>@foodType.FoodOptionTypeName</td>
                                                <td>@foodType.NumIncluded</td>
                                                <td>@foodType.MaxAmount</td>
                                                <td>$@foodType.FoodOptionPrice.ToString("F2")</td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-primary me-2"
                                                        @onclick="() => ShowEditFoodTypeModal(foodType)">
                                                        <i class="bi bi-pencil"></i> Edit
                                                    </button>
                                                    <button class="btn btn-sm btn-outline-danger"
                                                        @onclick="() => ShowDeleteFoodTypeConfirmation(foodType)">
                                                        <i class="bi bi-trash"></i> Delete
                                                    </button>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        }
                    </div>
                </div>
            }
        }
    </div>
</div>

@if (ShowFoodOptionModal)
{
    <FoodOptionModal FoodOption="SelectedFoodOption" OnSave="HandleFoodOptionSave" OnCancel="HandleFoodOptionCancel" />
}

@if (ShowFoodTypeModal)
{
    <FoodTypeModal FoodType="SelectedFoodType" OnSave="HandleFoodTypeSave" OnCancel="HandleFoodTypeCancel" />
}

<ConfirmationModal IsVisible="ShowDeleteFoodOptionModal" Title="Delete Food Option"
    Message="@($"Are you sure you want to delete '{FoodOptionToDelete?.FoodOptionName}'? This action cannot be undone.")"
    ConfirmText="Delete" OnConfirm="ConfirmDeleteFoodOption" OnCancel="CancelDeleteFoodOption" />

<ConfirmationModal IsVisible="ShowDeleteFoodTypeModal" Title="Delete Food Type"
    Message="@($"Are you sure you want to delete '{FoodTypeToDelete?.FoodOptionTypeName}'? This action cannot be undone.")"
    ConfirmText="Delete" OnConfirm="ConfirmDeleteFoodType" OnCancel="CancelDeleteFoodType" />

<Cafeteria.Management.Components.Shared.Toast Message="@toastMessage" Type="@toastType" IsVisible="@showToast" OnClose="@(() => showToast = false)" />