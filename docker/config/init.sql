-- psql -U $POSTGRES_USER $POSTGRES_DB

CREATE SCHEMA IF NOT EXISTS cafeteria;

CREATE TABLE cafeteria.cafeteria_location (
    id int4 GENERATED BY DEFAULT AS IDENTITY,
    location_name varchar(100) NOT NULL,
    location_description varchar(200) NOT NULL,
    location_address varchar(200) NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE cafeteria.week_day (
    id int4 GENERATED BY DEFAULT AS IDENTITY,
    weekday_name varchar(20) NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE cafeteria.location_business_hours (
    id int4 GENERATED BY DEFAULT AS IDENTITY,
    location_id int4 NOT NULL,
    weekday_id int4 NOT NULL,
    open_time time NOT NULL,
    close_time time NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (location_id) REFERENCES cafeteria.cafeteria_location(id),
    FOREIGN KEY (weekday_id) REFERENCES cafeteria.week_day(id)
);

CREATE TABLE cafeteria.station (
    id int4 GENERATED BY DEFAULT AS IDENTITY,
    location_id int4 NOT NULL,
    station_name varchar(100) NOT NULL,
    station_description varchar(200) NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (location_id) REFERENCES cafeteria.cafeteria_location(id)
);

CREATE TABLE cafeteria.ingredient_type (
    id int4 GENERATED BY DEFAULT AS IDENTITY,
    type_name varchar(100) NOT NULL,
    quantity int4 NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE cafeteria.ingredient (
    id int4 GENERATED BY DEFAULT AS IDENTITY,
    ingredient_name varchar(100) NOT NULL,
    image_url varchar(300),
    ingredient_price decimal,
    PRIMARY KEY (id)
);

CREATE TABLE cafeteria.ingredient_ingredient_type (
    id int4 GENERATED BY DEFAULT AS IDENTITY,
    ingredient_type_id int4 NOT NULL,
    ingredient_id int4 NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (ingredient_type_id) REFERENCES cafeteria.ingredient_type(id),
    FOREIGN KEY (ingredient_id) REFERENCES cafeteria.ingredient(id)
);

CREATE TABLE cafeteria.food_item (
    id int4 GENERATED BY DEFAULT AS IDENTITY,
    station_id int4 NOT NULL,
    item_description varchar(200),
    image_url varchar(300),
    item_price decimal NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (station_id) REFERENCES cafeteria.station(id)
);

CREATE TABLE cafeteria.food_item_ingredient_type (
    id int4 GENERATED BY DEFAULT AS IDENTITY,
    food_item_id int4 NOT NULL,
    ingredient_type_id int4 NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (food_item_id) REFERENCES cafeteria.food_item(id),
    FOREIGN KEY (ingredient_type_id) REFERENCES cafeteria.ingredient_type(id)
);

CREATE TABLE cafeteria.food_builder_item_ingredient (
    id int4 GENERATED BY DEFAULT AS IDENTITY,
    food_item_id int4 NOT NULL,
    ingredient_id int4 NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (food_item_id) REFERENCES cafeteria.food_item(id),
    FOREIGN KEY (ingredient_id) REFERENCES cafeteria.ingredient(id)
);

INSERT INTO cafeteria.cafeteria_location (location_name, location_description, location_address) VALUES
    ('Badger Den', 'Located on the main floor of the Greenwood Student Center', '242-260 E 100 N, Ephraim, UT 84627'),
    ('Busters Bistro', 'Located on the main floor of the Karen H Huntsman Library', '141 E Center St, Ephraim, UT 84627');

INSERT INTO cafeteria.week_day (weekday_name) VALUES
    ('Monday'),
    ('Tuesday'),
    ('Wednesday'),
    ('Thursday'),
    ('Friday'),
    ('Saturday'),
    ('Sunday');

INSERT INTO cafeteria.cafeteria_location (location_name, location_description, location_address) VALUES
    ('Badger Den', 'Located on the main floor of the Greenwood Student Center', '242-260 E 100 N, Ephraim, UT 84627'),
    ('Busters Bistro', 'Located on the main floor of the Karen H Huntsman Library', '141 E Center St, Ephraim, UT 84627');

INSERT INTO cafeteria.location_business_hours (location_id, weekday_id, open_time, close_time) VALUES
    (1, 1, '08:00:00', '19:30:00'),
    (1, 2, '08:00:00', '19:30:00'),
    (1, 3, '08:00:00', '19:30:00'),
    (1, 4, '08:00:00', '19:30:00'),
    (1, 5, '08:00:00', '19:30:00'),
    (1, 6, '17:00:00', '19:00:00'),
    (1, 7, '17:00:00', '19:00:00'),
    (2, 1, '10:00:00', '19:30:00'),
    (2, 2, '10:00:00', '19:30:00'),
    (2, 3, '10:00:00', '19:30:00'),
    (2, 4, '10:00:00', '19:30:00'),
    (2, 5, '10:00:00', '15:00:00');