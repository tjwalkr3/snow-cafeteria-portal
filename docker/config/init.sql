-- psql -U $POSTGRES_USER $POSTGRES_DB

CREATE SCHEMA IF NOT EXISTS cafeteria;

CREATE TABLE cafeteria.cafeteria_location (
    id int4 GENERATED BY DEFAULT AS IDENTITY,
    location_name varchar(100) NOT NULL,
    location_description varchar(200) NOT NULL,
    address varchar(200) NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE cafeteria.week_day (
    id int4 GENERATED BY DEFAULT AS IDENTITY,
    weekday_name varchar(20) NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE cafeteria.location_business_hours (
    id int4 GENERATED BY DEFAULT AS IDENTITY,
    location_id int4 NOT NULL,
    weekday_id int4 NOT NULL,
    open_time time NOT NULL,
    close_time time NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (location_id) REFERENCES cafeteria.cafeteria_location(id),
    FOREIGN KEY (weekday_id) REFERENCES cafeteria.week_day(id)
);

CREATE TABLE cafeteria.station (
    id int4 GENERATED BY DEFAULT AS IDENTITY,
    location_id int4 NOT NULL,
    station_name varchar(100) NOT NULL,
    station_description varchar(200) NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (location_id) REFERENCES cafeteria.cafeteria_location(id)
);

CREATE TABLE cafeteria.ingredient_type (
    id int4 GENERATED BY DEFAULT AS IDENTITY,
    type_name varchar(100) NOT NULL,
    quantity int4 NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE cafeteria.ingredient (
    id int4 GENERATED BY DEFAULT AS IDENTITY,
    ingredient_name varchar(100) NOT NULL,
    image_url varchar(300),
    ingredient_price decimal,
    PRIMARY KEY (id)
);

CREATE TABLE cafeteria.ingredient_ingredient_type (
    id int4 GENERATED BY DEFAULT AS IDENTITY,
    ingredient_type_id int4 NOT NULL,
    ingredient_id int4 NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (ingredient_type_id) REFERENCES cafeteria.ingredient_type(id),
    FOREIGN KEY (ingredient_id) REFERENCES cafeteria.ingredient(id)
);

CREATE TABLE cafeteria.food_item (
    id int4 GENERATED BY DEFAULT AS IDENTITY,
    station_id int4 NOT NULL,
    item_description varchar(200),
    image_url varchar(300),
    item_price decimal NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (station_id) REFERENCES cafeteria.station(id)
);

CREATE TABLE cafeteria.food_item_ingredient_type (
    id int4 GENERATED BY DEFAULT AS IDENTITY,
    food_item_id int4 NOT NULL,
    ingredient_type_id int4 NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (food_item_id) REFERENCES cafeteria.food_item(id),
    FOREIGN KEY (ingredient_type_id) REFERENCES cafeteria.ingredient_type(id)
);

CREATE TABLE cafeteria.food_builder_item_ingredient (
    id int4 GENERATED BY DEFAULT AS IDENTITY,
    food_item_id int4 NOT NULL,
    ingredient_id int4 NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (food_item_id) REFERENCES cafeteria.food_item(id),
    FOREIGN KEY (ingredient_id) REFERENCES cafeteria.ingredient(id)
);