-- psql -U $POSTGRES_USER $POSTGRES_DB
CREATE SCHEMA IF NOT EXISTS cafeteria;

CREATE TABLE
    cafeteria.cafeteria_location (
        id int4 GENERATED BY DEFAULT AS IDENTITY,
        location_name varchar(100) NOT NULL,
        location_description varchar(200) NOT NULL,
        location_address varchar(200) NOT NULL,
        PRIMARY KEY (id)
    );

CREATE TABLE
    cafeteria.week_day (
        id int4 GENERATED BY DEFAULT AS IDENTITY,
        weekday_name varchar(20) NOT NULL,
        PRIMARY KEY (id)
    );

CREATE TABLE
    cafeteria.location_business_hours (
        id int4 GENERATED BY DEFAULT AS IDENTITY,
        location_id int4 NOT NULL,
        weekday_id int4 NOT NULL,
        open_time time NOT NULL,
        close_time time NOT NULL,
        PRIMARY KEY (id),
        FOREIGN KEY (location_id) REFERENCES cafeteria.cafeteria_location (id),
        FOREIGN KEY (weekday_id) REFERENCES cafeteria.week_day (id)
    );

CREATE TABLE
    cafeteria.station (
        id int4 GENERATED BY DEFAULT AS IDENTITY,
        location_id int4 NOT NULL,
        station_name varchar(100) NOT NULL,
        station_description varchar(200) NOT NULL,
        PRIMARY KEY (id),
        FOREIGN KEY (location_id) REFERENCES cafeteria.cafeteria_location (id)
    );

CREATE TABLE
    cafeteria.ingredient_type (
        id int4 GENERATED BY DEFAULT AS IDENTITY,
        type_name varchar(100) NOT NULL,
        quantity int4 NOT NULL,
        PRIMARY KEY (id)
    );

CREATE TABLE
    cafeteria.ingredient (
        id int4 GENERATED BY DEFAULT AS IDENTITY,
        ingredient_name varchar(100) NOT NULL,
        image_url varchar(300),
        ingredient_price decimal,
        PRIMARY KEY (id)
    );

CREATE TABLE
    cafeteria.ingredient_ingredient_type (
        id int4 GENERATED BY DEFAULT AS IDENTITY,
        ingredient_type_id int4 NOT NULL,
        ingredient_id int4 NOT NULL,
        PRIMARY KEY (id),
        FOREIGN KEY (ingredient_type_id) REFERENCES cafeteria.ingredient_type (id),
        FOREIGN KEY (ingredient_id) REFERENCES cafeteria.ingredient (id)
    );

CREATE TABLE
    cafeteria.food_item (
        id int4 GENERATED BY DEFAULT AS IDENTITY,
        station_id int4 NOT NULL,
        item_description varchar(200),
        image_url varchar(300),
        item_price decimal NOT NULL,
        PRIMARY KEY (id),
        FOREIGN KEY (station_id) REFERENCES cafeteria.station (id)
    );

CREATE TABLE
    cafeteria.food_item_ingredient_type (
        id int4 GENERATED BY DEFAULT AS IDENTITY,
        food_item_id int4 NOT NULL,
        ingredient_type_id int4 NOT NULL,
        PRIMARY KEY (id),
        FOREIGN KEY (food_item_id) REFERENCES cafeteria.food_item (id),
        FOREIGN KEY (ingredient_type_id) REFERENCES cafeteria.ingredient_type (id)
    );

CREATE TABLE
    cafeteria.food_builder_item_ingredient (
        id int4 GENERATED BY DEFAULT AS IDENTITY,
        food_item_id int4 NOT NULL,
        ingredient_id int4 NOT NULL,
        PRIMARY KEY (id),
        FOREIGN KEY (food_item_id) REFERENCES cafeteria.food_item (id),
        FOREIGN KEY (ingredient_id) REFERENCES cafeteria.ingredient (id)
    );

INSERT INTO cafeteria.cafeteria_location (id, location_name, location_description, location_address) VALUES
    (1, 'Badger Den', 'Campus dining location in the GSC', 'GSC Cafeteria on the Ground Floor'),
    (2, 'Buster''s Bistro', 'Library dining location', 'Karen H. Huntsman Library Gallery');

INSERT INTO cafeteria.week_day (id, weekday_name) VALUES
    (1, 'Monday'),
    (5, 'Friday');

INSERT INTO cafeteria.location_business_hours (id, location_id, weekday_id, open_time, close_time) VALUES
    (1, 1, 1, '08:00:00', '18:00:00'),
    (2, 1, 5, '08:00:00', '16:00:00');

INSERT INTO cafeteria.station (id, location_id, station_name, station_description) VALUES
    (1, 1, 'Sandwich Station', 'Fresh made-to-order sandwiches'),
    (2, 1, 'Salad Bar', 'Fresh salads and healthy options');

INSERT INTO cafeteria.ingredient_type (id, type_name, quantity) VALUES
    (1, 'Bread', 1),
    (2, 'Meat', 1),
    (3, 'Vegetable', 2);

INSERT INTO cafeteria.ingredient (id, ingredient_name, image_url, ingredient_price) VALUES
    (1, 'Wheat Bread', 'https://picsum.photos/id/98/150/150', 0),
    (2, 'Sliced Turkey', 'https://picsum.photos/id/429/150/150', 2.50),
    (3, 'Fresh Lettuce', 'https://picsum.photos/id/550/150/150', 0),
    (4, 'Sliced Tomato', 'https://picsum.photos/id/189/150/150', 0.25);

INSERT INTO cafeteria.food_item (id, station_id, item_description, image_url, item_price) VALUES
    (1, 1, 'Turkey sandwich with lettuce on wheat bread', 'https://picsum.photos/id/488/150/150', 6.50),
    (2, 2, 'Fresh green salad with lettuce and tomato', 'https://picsum.photos/id/550/150/150', 4.95);

INSERT INTO cafeteria.ingredient_ingredient_type (ingredient_id, ingredient_type_id) VALUES
    (1, 1),
    (2, 2),
    (3, 3),
    (4, 3);

INSERT INTO cafeteria.food_item_ingredient_type (food_item_id, ingredient_type_id) VALUES
    (1, 1),
    (1, 2),
    (1, 3),
    (2, 3);